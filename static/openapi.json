{
    "swagger": "2.0",
    "paths": {
        "/v0/metadata": {
            "get": {
                "tags": [
                    "query"
                ],
                "summary": "Get metadata",
                "description": "",
                "operationId": "Metadata",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "Successful request",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/Model"
                            }
                        }
                    }
                }
            }
        },
        "/v0/query": {
            "post": {
                "tags": [
                    "query"
                ],
                "summary": "Execute query",
                "description": "",
                "operationId": "Query",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "Successful request",
                        "schema": {
                            "$ref": "#/definitions/TaskTicketQueryResult"
                        }
                    }
                }
            }
        },
        "/v0/update-manifest": {
            "put": {
                "tags": [
                    "query"
                ],
                "summary": "Update manifest.json file",
                "description": "",
                "operationId": "UpdateManifest",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "Successful request",
                        "schema": {
                            "$ref": "#/definitions/SuccessMessage"
                        }
                    }
                }
            }
        },
        "/api/task/cancel": {
            "post": {
                "tags": [
                    "task"
                ],
                "summary": "Cancel a query",
                "description": "",
                "operationId": "CancelQuery",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "Successful request",
                        "schema": {
                            "$ref": "#/definitions/SuccessMessage"
                        }
                    }
                }
            }
        },
        "/api/task/status": {
            "get": {
                "tags": [
                    "task"
                ],
                "summary": "View task status",
                "description": "",
                "operationId": "Status",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "Successful request",
                        "schema": {
                            "$ref": "#/definitions/TaskTicketObject"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "ErrorMessage": {
            "type": "object",
            "required": [
                "errors",
                "meta"
            ],
            "properties": {
                "errors": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/JsonAPIError"
                    }
                },
                "meta": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "object"
                    }
                }
            }
        },
        "Column": {
            "allOf": [
                {
                    "$ref": "#/definitions/MeasureValue"
                },
                {
                    "type": "object",
                    "required": [
                        "aggregation"
                    ],
                    "properties": {
                        "aggregation": {
                            "type": "string",
                            "enum": [
                                "COUNT",
                                "COUNT_UNIQUE",
                                "SUM",
                                "MINIMUM",
                                "MAXIMUM",
                                "AVERAGE",
                                "APPROXIMATE_UNIQUE",
                                "SUM_DISTINCT",
                                "AVERAGE_DISTINCT"
                            ]
                        },
                        "column": {
                            "type": "string"
                        }
                    }
                }
            ]
        },
        "ColumnValue": {
            "allOf": [
                {
                    "$ref": "#/definitions/RelationValue"
                },
                {
                    "type": "object",
                    "required": [
                        "sourceColumn",
                        "targetColumn"
                    ],
                    "properties": {
                        "sourceColumn": {
                            "type": "string"
                        },
                        "targetColumn": {
                            "type": "string"
                        }
                    }
                }
            ]
        },
        "Dimension": {
            "allOf": [
                {
                    "$ref": "#/definitions/MeasureValue"
                },
                {
                    "type": "object",
                    "required": [
                        "aggregation"
                    ],
                    "properties": {
                        "aggregation": {
                            "type": "string",
                            "enum": [
                                "COUNT",
                                "COUNT_UNIQUE",
                                "SUM",
                                "MINIMUM",
                                "MAXIMUM",
                                "AVERAGE",
                                "APPROXIMATE_UNIQUE",
                                "SUM_DISTINCT",
                                "AVERAGE_DISTINCT"
                            ]
                        },
                        "dimension": {
                            "type": "string"
                        }
                    }
                }
            ]
        },
        "DimensionReference": {
            "type": "object",
            "required": [
                "name"
            ],
            "properties": {
                "name": {
                    "$ref": "#/definitions/MetricReference"
                },
                "timeframe": {
                    "type": "string"
                }
            }
        },
        "DimensionValue": {
            "type": "object"
        },
        "Enum": {
            "type": "object"
        },
        "Filter": {
            "type": "object",
            "required": [
                "operator",
                "valueType"
            ],
            "properties": {
                "valueType": {
                    "type": "string",
                    "enum": [
                        "STRING",
                        "INTEGER",
                        "DECIMAL",
                        "DOUBLE",
                        "LONG",
                        "BOOLEAN",
                        "DATE",
                        "TIME",
                        "TIMESTAMP",
                        "BINARY",
                        "ARRAY_STRING",
                        "ARRAY_INTEGER",
                        "ARRAY_DOUBLE",
                        "ARRAY_LONG",
                        "ARRAY_BOOLEAN",
                        "ARRAY_DATE",
                        "ARRAY_TIME",
                        "ARRAY_TIMESTAMP",
                        "MAP_STRING",
                        "UNKNOWN"
                    ]
                },
                "operator": {
                    "$ref": "#/definitions/Enum"
                },
                "value": {
                    "type": "object"
                }
            }
        },
        "FilterReference": {
            "type": "object",
            "required": [
                "operator"
            ],
            "properties": {
                "dimension": {
                    "$ref": "#/definitions/DimensionReference"
                },
                "measure": {
                    "$ref": "#/definitions/MetricReference"
                },
                "mapping": {
                    "type": "string"
                },
                "operator": {
                    "type": "string"
                },
                "value": {
                    "type": "object"
                }
            }
        },
        "FilterValue": {
            "type": "object"
        },
        "Function": {
            "allOf": [
                {
                    "$ref": "#/definitions/ReportMetric"
                },
                {
                    "type": "object",
                    "required": [
                        "name",
                        "parameters"
                    ],
                    "properties": {
                        "name": {
                            "type": "string",
                            "enum": [
                                "COUNT"
                            ]
                        },
                        "parameters": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/ReportMetric"
                            }
                        }
                    }
                }
            ]
        },
        "Materialize": {
            "type": "object",
            "required": [
                "name",
                "reportType",
                "value"
            ],
            "properties": {
                "name": {
                    "type": "string"
                },
                "reportType": {
                    "type": "string",
                    "enum": [
                        "SEGMENTATION",
                        "FUNNEL",
                        "FLOW",
                        "RETENTION",
                        "SQL"
                    ]
                },
                "value": {
                    "$ref": "#/definitions/SegmentationMaterialize"
                }
            }
        },
        "Measure": {
            "type": "object",
            "required": [
                "name",
                "type",
                "value"
            ],
            "properties": {
                "name": {
                    "type": "string"
                },
                "label": {
                    "type": "string"
                },
                "description": {
                    "type": "string"
                },
                "category": {
                    "type": "string"
                },
                "type": {
                    "type": "string",
                    "enum": [
                        "COLUMN",
                        "DIMENSION",
                        "SQL"
                    ]
                },
                "value": {
                    "$ref": "#/definitions/MeasureValue"
                },
                "filters": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/ReportFilter"
                    }
                },
                "reportOptions": {
                    "type": "object"
                },
                "fieldType": {
                    "type": "string",
                    "enum": [
                        "STRING",
                        "INTEGER",
                        "DECIMAL",
                        "DOUBLE",
                        "LONG",
                        "BOOLEAN",
                        "DATE",
                        "TIME",
                        "TIMESTAMP",
                        "BINARY",
                        "ARRAY_STRING",
                        "ARRAY_INTEGER",
                        "ARRAY_DOUBLE",
                        "ARRAY_LONG",
                        "ARRAY_BOOLEAN",
                        "ARRAY_DATE",
                        "ARRAY_TIME",
                        "ARRAY_TIMESTAMP",
                        "MAP_STRING",
                        "UNKNOWN"
                    ]
                },
                "hidden": {
                    "type": "boolean"
                },
                "drills": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/ReportMetric"
                    }
                }
            }
        },
        "MeasureValue": {
            "type": "object"
        },
        "MetricFilter": {
            "allOf": [
                {
                    "$ref": "#/definitions/FilterValue"
                },
                {
                    "type": "object",
                    "required": [
                        "filters",
                        "metricType",
                        "metricValue"
                    ],
                    "properties": {
                        "metricType": {
                            "type": "string",
                            "enum": [
                                "UNARY",
                                "LITERAL",
                                "FUNCTION",
                                "DIMENSION",
                                "MAPPING_DIMENSION",
                                "MEASURE"
                            ]
                        },
                        "metricValue": {
                            "$ref": "#/definitions/ReportMetric"
                        },
                        "filters": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/Filter"
                            }
                        }
                    }
                }
            ]
        },
        "MetricReference": {
            "type": "object",
            "required": [
                "isMappingDimension",
                "name"
            ],
            "properties": {
                "name": {
                    "type": "string"
                },
                "relation": {
                    "type": "string"
                },
                "isMappingDimension": {
                    "type": "boolean"
                }
            }
        },
        "Model": {
            "type": "object",
            "required": [
                "dimensions",
                "hidden",
                "mappings",
                "measures",
                "name",
                "relations",
                "target"
            ],
            "properties": {
                "name": {
                    "type": "string"
                },
                "hidden": {
                    "type": "boolean"
                },
                "target": {
                    "$ref": "#/definitions/Target"
                },
                "label": {
                    "type": "string"
                },
                "description": {
                    "type": "string"
                },
                "category": {
                    "type": "string"
                },
                "mappings": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "relations": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Relation"
                    }
                },
                "dimensions": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Dimension"
                    }
                },
                "measures": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Measure"
                    }
                },
                "materializes": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Materialize"
                    }
                },
                "alwaysFilters": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/FilterReference"
                    }
                },
                "id": {
                    "type": "integer",
                    "format": "int32"
                },
                "recipeId": {
                    "type": "integer",
                    "format": "int32"
                },
                "recipePath": {
                    "type": "string"
                }
            }
        },
        "PostOperation": {
            "type": "object",
            "required": [
                "type",
                "value"
            ],
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "TIMESTAMP",
                        "DATE",
                        "TIME"
                    ]
                },
                "value": {
                    "$ref": "#/definitions/Enum"
                }
            }
        },
        "Relation": {
            "type": "object",
            "required": [
                "joinType",
                "modelName",
                "name",
                "relationType",
                "type",
                "value"
            ],
            "properties": {
                "name": {
                    "type": "string"
                },
                "label": {
                    "type": "string"
                },
                "description": {
                    "type": "string"
                },
                "relationType": {
                    "type": "string",
                    "enum": [
                        "ONE_TO_ONE",
                        "ONE_TO_MANY",
                        "MANY_TO_ONE",
                        "MANY_TO_MANY"
                    ]
                },
                "joinType": {
                    "type": "string",
                    "enum": [
                        "INNER_JOIN",
                        "LEFT_JOIN",
                        "RIGHT_JOIN",
                        "FULL_JOIN"
                    ]
                },
                "modelName": {
                    "type": "string"
                },
                "type": {
                    "type": "string",
                    "enum": [
                        "DIMENSION",
                        "COLUMN",
                        "SQL"
                    ]
                },
                "value": {
                    "$ref": "#/definitions/RelationValue"
                },
                "hidden": {
                    "type": "boolean"
                }
            }
        },
        "RelationValue": {
            "type": "object"
        },
        "ReportDimension": {
            "allOf": [
                {
                    "$ref": "#/definitions/ReportMetric"
                },
                {
                    "type": "object",
                    "required": [
                        "name"
                    ],
                    "properties": {
                        "name": {
                            "type": "string"
                        },
                        "modelName": {
                            "type": "string"
                        },
                        "relationName": {
                            "type": "string"
                        },
                        "postOperation": {
                            "$ref": "#/definitions/PostOperation"
                        },
                        "pivot": {
                            "type": "boolean"
                        }
                    }
                }
            ]
        },
        "ReportFilter": {
            "type": "object",
            "required": [
                "type",
                "value"
            ],
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "SQL_FILTER",
                        "METRIC_FILTER"
                    ]
                },
                "value": {
                    "$ref": "#/definitions/FilterValue"
                }
            }
        },
        "ReportMappingDimension": {
            "allOf": [
                {
                    "$ref": "#/definitions/ReportMetric"
                },
                {
                    "type": "object",
                    "required": [
                        "name"
                    ],
                    "properties": {
                        "name": {
                            "type": "string",
                            "enum": [
                                "EVENT_TIMESTAMP",
                                "INCREMENTAL",
                                "USER_ID",
                                "DEVICE_ID",
                                "SESSION_ID"
                            ]
                        },
                        "postOperation": {
                            "$ref": "#/definitions/PostOperation"
                        }
                    }
                }
            ]
        },
        "ReportMeasure": {
            "allOf": [
                {
                    "$ref": "#/definitions/ReportMetric"
                },
                {
                    "type": "object",
                    "required": [
                        "modelName",
                        "name"
                    ],
                    "properties": {
                        "modelName": {
                            "type": "string"
                        },
                        "name": {
                            "type": "string"
                        },
                        "relationName": {
                            "type": "string"
                        }
                    }
                }
            ]
        },
        "ReportMetric": {
            "type": "object"
        },
        "SegmentationMaterialize": {
            "type": "object",
            "required": [
                "measures"
            ],
            "properties": {
                "measures": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/MetricReference"
                    }
                },
                "dimensions": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/DimensionReference"
                    }
                },
                "filters": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/FilterReference"
                    }
                }
            }
        },
        "Sql": {
            "allOf": [
                {
                    "$ref": "#/definitions/FilterValue"
                },
                {
                    "type": "object",
                    "required": [
                        "sql"
                    ],
                    "properties": {
                        "sql": {
                            "type": "string"
                        }
                    }
                }
            ]
        },
        "SqlValue": {
            "allOf": [
                {
                    "$ref": "#/definitions/RelationValue"
                },
                {
                    "type": "object",
                    "required": [
                        "sql"
                    ],
                    "properties": {
                        "sql": {
                            "type": "string"
                        }
                    }
                }
            ]
        },
        "Table": {
            "allOf": [
                {
                    "$ref": "#/definitions/TargetValue"
                },
                {
                    "type": "object",
                    "required": [
                        "table"
                    ],
                    "properties": {
                        "database": {
                            "type": "string"
                        },
                        "schema": {
                            "type": "string"
                        },
                        "table": {
                            "type": "string"
                        }
                    }
                }
            ]
        },
        "Target": {
            "type": "object",
            "required": [
                "type",
                "value"
            ],
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "TABLE",
                        "SQL"
                    ]
                },
                "value": {
                    "$ref": "#/definitions/TargetValue"
                }
            }
        },
        "TargetValue": {
            "type": "object"
        },
        "Unary": {
            "allOf": [
                {
                    "$ref": "#/definitions/ReportMetric"
                },
                {
                    "type": "object",
                    "required": [
                        "left",
                        "operator",
                        "right"
                    ],
                    "properties": {
                        "operator": {
                            "type": "string",
                            "enum": [
                                "PLUS",
                                "MINUS"
                            ]
                        },
                        "left": {
                            "$ref": "#/definitions/ReportMetric"
                        },
                        "right": {
                            "$ref": "#/definitions/ReportMetric"
                        }
                    }
                }
            ]
        },
        "QueryColumn": {
            "type": "object",
            "required": [
                "name",
                "position"
            ],
            "properties": {
                "name": {
                    "type": "string"
                },
                "position": {
                    "type": "integer",
                    "format": "int32"
                },
                "type": {
                    "type": "string",
                    "enum": [
                        "STRING",
                        "INTEGER",
                        "DECIMAL",
                        "DOUBLE",
                        "LONG",
                        "BOOLEAN",
                        "DATE",
                        "TIME",
                        "TIMESTAMP",
                        "BINARY",
                        "ARRAY_STRING",
                        "ARRAY_INTEGER",
                        "ARRAY_DOUBLE",
                        "ARRAY_LONG",
                        "ARRAY_BOOLEAN",
                        "ARRAY_DATE",
                        "ARRAY_TIME",
                        "ARRAY_TIMESTAMP",
                        "MAP_STRING",
                        "UNKNOWN"
                    ]
                },
                "dbType": {
                    "type": "string"
                }
            }
        },
        "QueryError": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string"
                },
                "sqlState": {
                    "type": "string"
                },
                "errorCode": {
                    "type": "integer",
                    "format": "int32"
                },
                "errorLine": {
                    "type": "integer",
                    "format": "int32"
                },
                "charPositionInLine": {
                    "type": "integer",
                    "format": "int32"
                }
            }
        },
        "QueryResult": {
            "type": "object",
            "properties": {
                "metadata": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/QueryColumn"
                    }
                },
                "result": {
                    "type": "array",
                    "items": {
                        "type": "array",
                        "items": {
                            "type": "object"
                        }
                    }
                },
                "error": {
                    "$ref": "#/definitions/QueryError"
                },
                "properties": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "object"
                    }
                }
            }
        },
        "TaskTicket": {
            "type": "object",
            "required": [
                "startedAt",
                "status"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "format": "uuid"
                },
                "startedAt": {
                    "type": "string",
                    "format": "date-time"
                },
                "status": {
                    "type": "string",
                    "enum": [
                        "IDLE",
                        "RUNNING",
                        "CANCELED",
                        "FINISHED"
                    ]
                },
                "update": {
                    "type": "object"
                },
                "result": {
                    "type": "object"
                }
            }
        },
        "TaskTicketQueryResult": {
            "type": "object",
            "required": [
                "startedAt",
                "status"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "format": "uuid"
                },
                "startedAt": {
                    "type": "string",
                    "format": "date-time"
                },
                "status": {
                    "type": "string",
                    "enum": [
                        "IDLE",
                        "RUNNING",
                        "CANCELED",
                        "FINISHED"
                    ]
                },
                "update": {
                    "type": "object"
                },
                "result": {
                    "$ref": "#/definitions/QueryResult"
                }
            }
        },
        "Query": {
            "type": "object",
            "required": [
                "report",
                "type"
            ],
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "SEGMENTATION",
                        "FUNNEL",
                        "FLOW",
                        "RETENTION",
                        "SQL"
                    ]
                },
                "report": {
                    "$ref": "#/definitions/ServiceReportOptions"
                },
                "filters": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/ReportFilter"
                    }
                },
                "variables": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "object"
                    }
                },
                "useCache": {
                    "type": "boolean"
                },
                "initialWaitInSeconds": {
                    "type": "integer",
                    "format": "int64"
                },
                "dryRun": {
                    "type": "boolean"
                }
            }
        },
        "ServiceReportOptions": {
            "type": "object"
        },
        "SuccessMessage": {
            "type": "object",
            "required": [
                "success"
            ],
            "properties": {
                "message": {
                    "type": "string"
                },
                "success": {
                    "type": "boolean"
                }
            }
        },
        "TaskTicketObject": {
            "type": "object",
            "required": [
                "startedAt",
                "status"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "format": "uuid"
                },
                "startedAt": {
                    "type": "string",
                    "format": "date-time"
                },
                "status": {
                    "type": "string",
                    "enum": [
                        "IDLE",
                        "RUNNING",
                        "CANCELED",
                        "FINISHED"
                    ]
                },
                "update": {
                    "type": "object"
                },
                "result": {
                    "type": "object"
                }
            }
        }
    }
}